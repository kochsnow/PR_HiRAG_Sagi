# Sagi: 从静态问答到动态思考的AI Agent框架

在大模型技术飞速发展的今天，AI已经能够回答各种复杂问题。然而，当需要深度分析、多步推理和系统化思考时，传统的一问一答模式往往显得不足。如何让AI系统能够像人类专家一样进行结构化思考，成为当前AI研发中的关键挑战。

## 从静态检索到动态思考

### 传统RAG的局限

想象这样一个场景：当我们询问AI助手"如何优化大型电商网站的搜索功能"时，传统的检索增强生成(RAG)系统通常会按照以下流程工作：

1. 接收用户查询
2. 检索相关文档或知识片段
3. 基于检索内容生成回答

这种线性流程虽然简单高效，但存在明显局限：

- **缺乏规划能力**：无法将复杂任务分解为连贯的子任务
- **检索受限**：只能基于初始查询进行单次检索，难以根据中间结果调整检索策略
- **知识孤岛**：检索到的知识片段之间缺乏有机连接

### 人类专家的解决思路

相比之下，一个领域专家解决同样问题时，会采取截然不同的方法：

1. **问题分析**：将问题分解为多个方面（搜索算法、用户体验、性能优化等）
2. **资源规划**：确定需要查阅哪些资料、咨询哪些专家
3. **有序执行**：按照逻辑顺序处理各个子问题
4. **整合反思**：将各部分解决方案整合，并进行反思迭代

这种结构化思考方式正是Sagi要实现的核心目标。

## Sagi：双阶段工作流架构

Sagi通过创新的双阶段工作流架构，模拟人类专家的思考过程，实现了从静态响应到动态思考的转变。

### 计划生成阶段

在接收用户任务后，Sagi首先启动计划生成阶段：

1. **事实分析器(Fact Analyzer)**：识别任务中的已知事实、未知事实及需要检索或推导的信息
2. **领域模板选择器**：根据任务类型选择适合的计划模板，融入领域专业知识
3. **计划生成器(Planner)**：基于分析结果制定详细执行计划，包含多个连贯步骤

通过这个过程，Sagi将复杂任务转化为结构化的执行路径，而非简单地尝试一步回答全部内容。

### 计划执行阶段

有了清晰计划后，Sagi进入执行阶段：

1. **任务分流(Triage Agent)**：将各步骤智能分配给专门的工具代理
2. **工具代理集合**：
   - **文件检索代理**：访问本地知识库
   - **代码执行代理**：生成并运行代码
   - **网络搜索代理**：获取最新在线信息
3. **反思代理(Reflection Agent)**：持续评估执行状态，必要时调整计划

执行过程中，计划管理器(Plan Manager)全程跟踪执行状态，支持多轮对话中的计划追踪和状态管理。

![Sagi工作流架构图](assets/planning_workflow.png)

### 从直线到循环：反馈驱动的执行模式

与传统RAG系统的线性流程不同，Sagi实现了反馈驱动的循环执行模式：

- **动态检索**：根据执行中获得的新信息调整检索策略
- **计划调整**：基于反思结果修改执行计划
- **知识整合**：在执行过程中构建连贯的认知图景

这种循环模式使Sagi能够处理高度复杂且需要多轮交互的任务。

## GraphRAG：知识检索的立体视角

Sagi不仅在思考流程上实现了突破，在知识表示与检索技术上同样引入了创新。

### 基于图的知识整合

传统RAG系统通常将文档分割为独立段落进行检索，这种方法难以捕捉知识间的复杂关联。Sagi集成的GraphRAG技术通过图结构组织知识，实现了：

1. **实体关系表示**：将知识点表示为实体，并建立语义关联
2. **层次化组织**：从具体实例到抽象概念的多层次知识表示
3. **交叉领域连接**：建立不同知识领域间的桥接关系

### 语义与结构的双重检索

在检索时，GraphRAG能够同时考虑语义相关性和结构连接性，解决了传统检索中的两大挑战：

1. **结构距离与语义相关性矛盾**：不同领域但语义相关的知识点能够被有效连接
2. **局部与全局知识的割裂**：通过层次化结构将具体细节与抽象概念有机结合

这种立体化的知识检索能力，让Sagi在回答复杂问题时能够提供既有深度又有广度的解答。

## MCP：工具生态的无缝整合

Sagi的第三个核心创新是对Model Context Protocol (MCP)的深度整合。MCP是由Anthropic提出的标准化协议，旨在简化AI模型与外部工具的交互。

### MCP的价值

MCP为Sagi提供了三方面关键能力：

1. **标准化接口**：统一的工具调用接口，简化开发与集成
2. **工具无关性**：与具体工具实现解耦，支持灵活替换和升级
3. **生态系统接入**：能够连接到不断扩展的MCP工具生态

### Sagi中的MCP应用

在Sagi中，MCP被用于：

1. **工具代理连接**：让工具代理能够无缝调用外部服务
2. **资源获取**：通过统一接口访问不同类型的资源
3. **功能扩展**：便于开发者为Sagi添加新功能

通过MCP的整合，Sagi实现了"即插即用"的扩展性，能够灵活应对各类应用场景的需求。

## 实际应用案例

Sagi的架构设计使其特别适合于以下应用场景：

### 复杂研究分析

例如，当用户需要"分析最新量子计算进展对密码学的影响"时：

1. **计划阶段**：Sagi将任务分解为量子计算现状、密码学基础、潜在影响等子任务
2. **执行阶段**：不同工具代理协同工作，检索最新研究文献、分析技术发展趋势
3. **整合阶段**：将分散信息整合为一份全面分析报告

### 多步骤问题解决

当面对"如何为特定数据集设计高性能机器学习模型"这类问题时：

1. **计划阶段**：确定数据分析、模型选择、参数优化等步骤
2. **执行阶段**：代码执行代理可能会生成并运行数据分析代码，提供可视化结果
3. **反思调整**：根据中间结果调整模型选择策略

### 知识密集型任务

对于"比较不同框架实现特定功能的优缺点"等知识密集型任务：

1. **知识图谱构建**：将各框架的特性、优势组织为结构化知识
2. **多维度比较**：基于性能、易用性、社区支持等多个维度进行系统比较
3. **情境适配分析**：根据具体使用场景提供针对性建议

## 快速上手指南

Sagi提供了基于Docker的简易部署方案，便于开发者快速体验和集成：

```bash
# 克隆仓库
git clone [https://github.com/Kasma-Inc/Sagi.git](https://github.com/Kasma-Inc/Sagi.git)
cd Sagi
git submodule update --init --recursive

# 环境配置
cp .env.example .env
# 设置API密钥和其他配置

# 构建Docker容器
chmod +x dev/setup_dc.sh
./dev/setup_dc.sh

# 安装依赖并启动
pip install -e .
python cli.py
```

## 未来发展
作为一个活跃发展的开源项目，Sagi的路线图包括：

1. 交互式Web界面：提供更直观的用户交互体验
2. 高级文件分块与索引：增强知识处理能力
3. 对话历史与工作流状态管理：支持更复杂的多轮对话

## 结语
Sagi代表了AI Agent技术从简单反应式系统向结构化思考系统的重要演进。通过模拟人类专家的思考过程，结合先进的知识表示和工具集成技术，Sagi为构建真正能够"思考"的AI系统提供了开放平台。

无论是研究人员、开发者还是企业用户，都可以通过Sagi探索AI Agent的新可能性，共同推动智能系统向更高层次发展。

项目地址: https://github.com/Kasma-Inc/Sagi